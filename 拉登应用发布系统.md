> 地址：http://laden.gag.cn/

---
#### 第一步 添加webhook

* git 仓库 FE_BFK 组有权限（如果没有权限是无法备份，请联系相关人员添加权限，http://git.gag.cn/FE_BFK/declare-sales-mobile/project_members）

* pre 确认 build（代码打包目前统一build目录）

``` javascript
|——————————rootPath
	   |---build
	  	  --index.html
	   	  --index.css
```
如果跟上述目录不一致，请做如下更改

package.json文件：

``` javascript
    "build": "atool-build -o ./build/${npm_package_family}/${npm_package_name/{npm_package_version}",
```
修改为
``` javascript
    "build": "atool-build -o ./build", 
```


webpack.config文件：

``` javascript
  webpackConfig.plugins.push( new CopyWebpackPlugin([{
    from: __dirname + '/favicon.ico',
    to: __dirname + '/build/'
  },{
    from: __dirname + '/index.html',
    to: __dirname + '/build/'
  },{
    from: __dirname + '/src/img/',
    to: __dirname + '/build/img/'
  }]));
```
修改为
``` javascript
  webpackConfig.plugins.push( new CopyWebpackPlugin([{
    from: __dirname + '/favicon.ico',
    to: __dirname + '/build/database-data/'
  },{
    from: __dirname + '/index.html',
    to: __dirname + '/build/database-data/'
  },{
    from: __dirname + '/src/img/',
    to: __dirname + '/build/database-data/img/'
  }]));

```

* 在应用` package.json ` 添加webhook 字段

``` javascript
"webhook":{
	"buildPath":"打包后的文件目录"
}
// 例如 package.json
|——————————rootPath
	   |---src 
	   |---build
	   |---node_modules
	   |---test
{
	name:"ladeng",
	version:"1.0.1",
	webhook:{
		buildPath:"/build"
	}
}
```



* 在需要发布的应用项目中：应用  >  settings  > webhooks;
* webhook URL: http://dataladen.gag.cn/
*  选择 Tag push events ；点击 Add webhook

#### 第二步 git tag push 打版本版本标签 提交项目 

``` bash
	cd 目标应用
	git tag publish#v1.0.0
	git push --tag
```
`注意：tag标准写法： publish#标签名`;
**例如**
```bash
	git tag publish#test
	git push --tags
```

#### 第三步 登录拉登应用发布系统 http://laden.gag.cn/
* 应用配置 列表
	点击应用配置： 输入应用部署的路径
	例如：`/mnt/mfs/static/fe/webhook-test/laden-on-api`
	是否显示： 表示该应用配置是否有效；
	应用部署服务器： 点击选择即可；目前支持`3段、5段、8段 测试服务器发布`（3段5段8段目前目录配置是相同的，自定义发布请联系运维和系统管理员添加发布服务器）；
*  应用发布	
	根据自己配置的应用服务：点击发布；
	`注意`：
	* 应用代码量（50MB以内）发布时间约为3~5分钟，5分钟后手动刷新页面即可；
	* 应用代码量（大于50MB）发布时间较长；
	* 当前发布版本 与 最新版本相同 且发布成功 不允许第二次发布；
应用部署时间流程 有 git clone 或者 git pull 代码文件、登录应用部署服务器、备份项目代码、上传`buildPath`目标代码文件；
	* 应用发布成功后 当前最新版本 不允许重新发布；
	* 鼠标移入`发布`按钮就可以查看当前发布应用日志 
	* 部署完成 可以查看，打开部署项目相应的网址，查看源码 head 会添加 版本信息以及部署时间
``` htmlbars
<head>
	<!-- 版本信息 -->
	<meta name="version" content="v1.X.X"/>
	<!-- 部署时间 -->
	<meta name="date" content="20170101141417"/>
	<link rel="stylesheet" href="build/bundle.css?v=v1.X.X&date=20171010121212" />
</head>	
<!-- 样式以及css 会添加data和版本信息 -->
<script src="/app.js?v=v1.X.X&date=20171010121212"></script>
```

#### 第四步 回滚

点击回滚，选择回滚版本 确认回滚信息
`注意`：
* 当前部署版本信息和备份分支相同，则不允许回滚
* 

相关连接：

查看项目备份：http://git.gag.cn/groups/FE_BFK  （根据相应发布的版本，发布完成后会以分支的形式备份在`FE_BFK`下）；

### 核心功能点简述

*  解决版本发布时间戳问题，在发布时候拉登会对所有的静态资源打上新的时间戳，并且在index.html上打上发布版本标签，以用来排查发布代码的正确性。

*   应用发布权限同当前GIT仓库 Master权限一致，只有master权限的人才有发布权限。（对线上服务的发布有单独权限控制，默认运维ops账号）

*   备份和回滚group组FE_BFK：http://git.gag.cn/groups/FE_BFK

